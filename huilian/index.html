<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimal-ui,initial-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="format-detection" content="telephone=no" />
	<title>可可</title>
	<!-- 分享平台获取信息 -->
	<meta itemprop="name" content="半熟人婚恋-最靠谱的婚礼平台">
	<meta name="description" itemprop="description" content="半熟人婚恋-最靠谱的婚礼平台">
    <meta itemprop="image" content="logo.jpg">
    <link href="css/photoswipe.css" type="text/css" rel="stylesheet" />
    <link href="css/swiper.min.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script>
        function allowDrop(ev)
        {
            ev.preventDefault();
        }

        function drag(ev)
        {
            ev.dataTransfer.setData("Text",ev.target.id);
        }

        function drop(ev)
        {
            ev.preventDefault();
            var data=ev.dataTransfer.getData("Text");
            ev.target.appendChild(document.getElementById(data));
        }
    </script>
</head>
<body>
    <div class="top">
        <div class="top_content">
            <h2 class="title">
                <a class="goback fl" href="javascript:history.back(-1)">返回</a>
                <span class="title_dynamic">新发布</span>
                <em class="save_dynamic release_btn" id="saveDynamic">确定</em>
            </h2>
        </div>
    </div>
    <div class="wrap">
        <div class="release_wrap">
            <div class="textarea_wrap" ondrop="drop(event)" ondragover="allowDrop(event)">
                <textarea class="textarea" id="textarea" placeholder="说点什么..." ></textarea>
                <div class="text_num"><em id="num">0</em>/500</div>
            </div>
            <img src="images/add_img.png" ondragstart="drag(event)" style="width: 60px; pointer-events: auto;" alt="" />
            <ul class="dynamic_img_wrap">
                <li class="addImg">
                    <img src="images/add_img.png" ondragstart="drag(event)" alt="" />
                    <input class="add_photo_file" id="add_file_input" type="file" accept="image/*;capture=camera" capture="camera"  />
                </li>
            </ul>
        </div>
    </div>

<script src="js/autosize.js"></script>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/script.js"></script>
<script>
    var input = document.getElementById("add_file_input");
        //这边是判断本终端设备是否支持这个API。
        if(typeof FileReader==='undefined'){
            show_alert("抱歉，你的设备不支持 FileReader");
            input.setAttribute('disabled','disabled');
        }else{
            input.addEventListener('change',readFile,false); //如果支持就监听改变事件，一旦改变了就运行readFile函数。
        }
        //            删除图片
        function deleteImg(_this){
           var obj = $(_this);
            obj.parent().remove();
        }
        function readFile(){
            var file = this.files[0]; //获取file对象
            var reader = new FileReader(); //声明一个FileReader实例
            reader.readAsDataURL(file); //调用readAsDataURL方法来读取选中的图像文件
            //最后在onload事件中，获取到成功读取的文件内容，并以插入一个img节点的方式显示选中的图片
            reader.onload = function(e){
                $('.dynamic_img_wrap').prepend('<li> <img src="'+ this.result + '" /> <div onclick="deleteImg(this)"  class="delet_img"></div> </li>')
            }
        }

</script>
<script>
    //运动事件监听
    if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion',deviceMotionHandler,false);
    }

    //获取加速度信息
    //通过监听上一步获取到的x, y, z 值在一定时间范围内的变化率，进行设备是否有进行晃动的判断。
    //而为了防止正常移动的误判，需要给该变化率设置一个合适的临界值。
    var SHAKE_THRESHOLD = 4000;
    var last_update = 0;
    var x, y, z, last_x = 0, last_y = 0, last_z = 0;
    function deviceMotionHandler(eventData) {
        var acceleration =eventData.accelerationIncludingGravity;
        var curTime = new Date().getTime();
        if ((curTime-last_update)> 10) {
            var diffTime = curTime -last_update;
            last_update = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;
            var speed = Math.abs(x +y + z - last_x - last_y - last_z) / diffTime * 10000;
            if (speed > SHAKE_THRESHOLD) {
                alert("你中奖啦！");  // Do something
            }
            last_x = x;
            last_y = y;
            last_z = z;
        }
    }
</script>
</body>
</html>